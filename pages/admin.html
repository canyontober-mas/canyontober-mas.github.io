<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard - MAS Portal</title>
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../styles.css">
    <!-- Load Auth First (Protects Page) -->
    <script src="../auth.js"></script>
    <script>
        // Specific Admin Guard
        const user = JSON.parse(localStorage.getItem('mas_user'));
        if (!user || user.role !== 'admin') {
            window.location.href = '../index.html'; // Kick out non-admins
        }
    </script>
    <!-- Load CMS Logic -->
    <script src="../cms.js"></script>
</head>
<body>

    <nav class="sidebar">
        <div class="sidebar-header">
            <span style="color:red; font-weight:900;">MAS</span> Admin
        </div>
        <ul class="nav-links">
            <li><a href="../index.html">‚Üê Back to Portal</a></li>
            <li><a href="#" class="active">Content Manager</a></li>
            <li><a href="#">User Management</a></li>
        </ul>
    </nav>

    <main class="main-content">
        <header class="top-bar">
            <h3>Admin Command Center</h3>
            <div class="user-profile">Admin Mode</div>
        </header>

        <div class="dashboard-grid">
            
            <!-- 1. ALERT MANAGER -->
            <div class="card">
                <h2>üì¢ System Alert Banner</h2>
                <div class="info-box">This banner appears at the top of every page for all technicians.</div>
                
                <form onsubmit="handleAlertSubmit(event)">
                    <label style="display:block; margin:10px 0;"><strong>Message:</strong></label>
                    <textarea id="alertMsg" class="login-input" rows="3" required></textarea>
                    
                    <div style="display:flex; gap:20px; margin:15px 0;">
                        <div>
                            <label><strong>Type:</strong></label>
                            <select id="alertType" class="login-input" style="padding:5px;">
                                <option value="warning">Orange (Warning)</option>
                                <option value="error">Red (Critical)</option>
                                <option value="info">Blue (Info)</option>
                            </select>
                        </div>
                        <div style="display:flex; align-items:center;">
                            <label><strong>Active:</strong></label>
                            <input type="checkbox" id="alertActive" style="width:20px; height:20px; margin-left:10px;">
                        </div>
                    </div>

                    <button type="submit" class="action-btn" style="background:var(--primary-color); color:red; width:100%;">Save Alert Settings</button>
                </form>
            </div>

            <!-- 2. CHANGELOG MANAGER -->
            <div class="card">
                <h2>üìù Update "What's New"</h2>
                
                <form onsubmit="handleChangelogSubmit(event)" style="background:#f9f9f9; padding:15px; border-radius:6px; margin-bottom:20px;">
                    <input type="text" id="clTitle" placeholder="Title (e.g. New Pricing)" class="login-input" required>
                    <input type="text" id="clDesc" placeholder="Description" class="login-input" required>
                    <input type="text" id="clDate" placeholder="Date (e.g. Feb 03)" class="login-input" style="width:150px;" required>
                    <button type="submit" class="action-btn" style="background:#2e7d32; color:white; margin-top:10px;">+ Add Update</button>
                </form>

                <h3>Current History</h3>
                <div id="adminChangelogList" style="max-height:300px; overflow-y:auto;">
                    <!-- JS will populate this -->
                </div>
            </div>

        </div>
    </main>

    <script>
        // PRE-FILL DATA ON LOAD
        document.addEventListener('DOMContentLoaded', () => {
            const data = getCMSData();
            
            // Fill Alert Form
            document.getElementById('alertMsg').value = data.alert.message;
            document.getElementById('alertType').value = data.alert.type;
            document.getElementById('alertActive').checked = data.alert.active;

            // Fill Changelog List
            const list = document.getElementById('adminChangelogList');
            data.changelog.forEach((item, index) => {
                const row = document.createElement('div');
                row.className = 'search-result-item';
                row.innerHTML = `
                    <div style="flex:1;">
                        <strong>${item.date}</strong> - ${item.title}
                    </div>
                    <button onclick="deleteChangelogItem(${index})" style="background:#ffebee; color:red; border:none; padding:5px 10px; cursor:pointer;">Delete</button>
                `;
                list.appendChild(row);
            });
        });

        // HANDLE SUBMITS
        function handleAlertSubmit(e) {
            e.preventDefault();
            const msg = document.getElementById('alertMsg').value;
            const type = document.getElementById('alertType').value;
            const active = document.getElementById('alertActive').checked;
            updateAlert(msg, type, active);
        }

        function handleChangelogSubmit(e) {
            e.preventDefault();
            const title = document.getElementById('clTitle').value;
            const desc = document.getElementById('clDesc').value;
            const date = document.getElementById('clDate').value;
            addChangelogItem(date, title, desc);
        }
    </script>
</body>
</html>